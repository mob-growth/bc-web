---
import DashboardLayout from '../../components/portal/DashboardLayout.astro';
import SidebarNav from '../../components/portal/SidebarNav.astro';

// User data
const userData = {
  name: 'John',
  level: 'B2 Upper Intermediate',
  nextClass: {
    name: 'Business English B2',
    time: 'Tomorrow, 18:00 GMT',
    room: 'Room 3A / Online'
  },
  weeklyGoal: 5,
  weeklyProgress: 3
};

// Key metrics for English learning
const keyMetrics = [
  {
    label: 'Course Progress',
    value: '65',
    unit: '%',
    sublabel: '13 of 20 modules completed',
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" stroke="#b794d4" stroke-width="2"/>
      <path d="M12 6v6l4 2" stroke="#ff9ec7" stroke-width="2" stroke-linecap="round"/>
    </svg>`
  },
  {
    label: 'Attendance Rate',
    value: '92',
    unit: '%',
    sublabel: '23 of 25 classes attended',
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M9 11l3 3L22 4" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="#b794d4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>`
  },
  {
    label: 'Average Score',
    value: '78',
    unit: '%',
    sublabel: 'B2 level proficiency',
    icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="#ffd4e8" stroke-width="2" fill="#ffd4e8" opacity="0.3"/>
    </svg>`
  }
];

// Upcoming assignments
const upcomingAssignments = [
  {
    title: 'Essay: Business Communication',
    due: '2 days',
    type: 'writing',
    priority: 'high'
  },
  {
    title: 'Speaking Practice: Presentation',
    due: '5 days',
    type: 'speaking',
    priority: 'medium'
  },
  {
    title: 'Grammar Quiz: Conditionals',
    due: '1 week',
    type: 'quiz',
    priority: 'low'
  }
];

// Recent grades
const recentGrades = [
  { assignment: 'Vocabulary Test', score: 85, date: '2 days ago' },
  { assignment: 'Listening Exercise', score: 78, date: '1 week ago' },
  { assignment: 'Writing Task', score: 82, date: '2 weeks ago' }
];

// Learning streak data
const streakData = {
  current: 15,
  best: 28,
  weeklyTarget: 5,
  daysCompleted: 3
};
---

<DashboardLayout title="Dashboard" currentPage="dashboard">
  <SidebarNav slot="sidebar" currentPage="dashboard" />

  <div slot="header" class="header-content">
    <div>
      <h1 class="header-title">Welcome back, {userData.name}</h1>
      <p class="header-subtitle">Current Level: {userData.level}</p>
    </div>
  </div>

  <div class="dashboard-container">

    <!-- Next Class Card -->
    <div class="next-class-card">
      <div class="card-header">
        <h2 class="card-title">Next Class</h2>
        <span class="status-badge online">Online</span>
      </div>
      <div class="class-info">
        <h3 class="class-name">{userData.nextClass.name}</h3>
        <div class="class-details">
          <span class="detail-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v6l4 2"/>
            </svg>
            {userData.nextClass.time}
          </span>
          <span class="detail-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            {userData.nextClass.room}
          </span>
        </div>
      </div>
      <button class="join-btn">Join Class</button>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-grid">
      {keyMetrics.map((metric) => (
        <div class="metric-card">
          <div class="metric-header">
            <span class="metric-icon" set:html={metric.icon} />
            <span class="metric-label">{metric.label}</span>
          </div>
          <div class="metric-value">
            <span class="value-number">{metric.value}</span>
            <span class="value-unit">{metric.unit}</span>
          </div>
          <p class="metric-sublabel">{metric.sublabel}</p>
        </div>
      ))}
    </div>

    <!-- Two Column Layout -->
    <div class="content-grid">

      <!-- Left Column -->
      <div class="left-column">

        <!-- Upcoming Assignments -->
        <div class="assignments-card">
          <div class="card-header">
            <h2 class="card-title">Upcoming Assignments</h2>
            <a href="/portal/assignments" class="view-link">View all</a>
          </div>
          <div class="assignments-list">
            {upcomingAssignments.map((assignment) => (
              <div class="assignment-item">
                <div class="assignment-info">
                  <h4 class="assignment-title">{assignment.title}</h4>
                  <span class="assignment-due">Due in {assignment.due}</span>
                </div>
                <span class={`priority-badge ${assignment.priority}`}>
                  {assignment.priority}
                </span>
              </div>
            ))}
          </div>
        </div>

        <!-- Learning Streak -->
        <div class="streak-card">
          <div class="card-header">
            <h2 class="card-title">Learning Streak</h2>
          </div>
          <div class="streak-content">
            <div class="streak-main">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#ffcce0" opacity="0.3"/>
                <path d="M8 12C8 14 10 16 12 16C14 16 16 14 16 12C16 10 12 4 12 4C12 4 8 10 8 12Z" fill="#ffd4e8"/>
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#ff9ec7" stroke-width="2"/>
              </svg>
              <div class="streak-numbers">
                <span class="current-streak">{streakData.current} days</span>
                <span class="streak-label">Current streak</span>
              </div>
            </div>
            <div class="streak-stats">
              <div class="streak-stat">
                <span class="stat-label">Best</span>
                <span class="stat-value">{streakData.best} days</span>
              </div>
              <div class="streak-stat">
                <span class="stat-label">This week</span>
                <span class="stat-value">{streakData.daysCompleted}/{streakData.weeklyTarget} days</span>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Right Column -->
      <div class="right-column">

        <!-- Recent Grades -->
        <div class="grades-card">
          <div class="card-header">
            <h2 class="card-title">Recent Grades</h2>
            <a href="/portal/progress" class="view-link">View progress</a>
          </div>
          <div class="grades-list">
            {recentGrades.map((grade) => (
              <div class="grade-item">
                <div class="grade-info">
                  <h4 class="grade-assignment">{grade.assignment}</h4>
                  <span class="grade-date">{grade.date}</span>
                </div>
                <div class="grade-score">
                  <span class={`score ${grade.score >= 80 ? 'high' : grade.score >= 70 ? 'medium' : 'low'}`}>
                    {grade.score}%
                  </span>
                </div>
              </div>
            ))}
          </div>
          <div class="average-section">
            <span class="average-label">Average Score</span>
            <span class="average-value">81.7%</span>
          </div>
        </div>

        <!-- Weekly Goal Progress -->
        <div class="goal-card">
          <div class="card-header">
            <h2 class="card-title">Weekly Goal</h2>
          </div>
          <div class="goal-content">
            <div class="goal-progress">
              <div class="progress-bar">
                <div class="progress-fill" style={`width: ${(userData.weeklyProgress / userData.weeklyGoal) * 100}%`}></div>
              </div>
              <span class="goal-text">{userData.weeklyProgress} of {userData.weeklyGoal} classes attended</span>
            </div>
            <div class="goal-days">
              {[...Array(7)].map((_, i) => (
                <div class={`day ${i < userData.weeklyProgress ? 'completed' : ''} ${i === userData.weeklyProgress - 1 ? 'current' : ''}`}>
                  {['M', 'T', 'W', 'T', 'F', 'S', 'S'][i]}
                </div>
              ))}
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</DashboardLayout>

<style>
  /* Dashboard Container */
  .dashboard-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 0;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Header */
  .header-content {
    width: 100%;
  }

  .header-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--bc-primary-blue);
    margin-bottom: 0.25rem;
  }

  .header-subtitle {
    font-size: 0.9375rem;
    color: var(--bc-medium-gray);
  }

  /* Next Class Card */
  .next-class-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid #f0f0f0;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--bc-primary-blue);
  }

  .status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
  }

  .status-badge.online {
    background: #e6f7ff;
    color: #0066cc;
  }

  .class-info {
    margin-bottom: 1.25rem;
  }

  .class-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--bc-dark-gray);
    margin-bottom: 0.75rem;
  }

  .class-details {
    display: flex;
    gap: 1.5rem;
  }

  .detail-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--bc-medium-gray);
  }

  .detail-item svg {
    stroke: var(--bc-medium-gray);
  }

  .join-btn {
    padding: 0.625rem 1.5rem;
    background: var(--bc-primary-blue);
    color: white;
    border: none;
    display: inline-block;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .join-btn:hover {
    background: #1a0545;
  }

  /* Key Metrics Grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .metric-card {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid #f0f0f0;
  }

  .metric-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .metric-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .metric-icon svg {
    width: 100%;
    height: 100%;
  }

  .metric-label {
    font-size: 0.875rem;
    color: var(--bc-medium-gray);
    font-weight: 500;
  }

  .metric-value {
    display: flex;
    align-items: baseline;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .value-number {
    font-size: 2rem;
    font-weight: 600;
    color: var(--bc-primary-blue);
  }

  .value-unit {
    font-size: 1.25rem;
    color: var(--bc-medium-gray);
  }

  .metric-sublabel {
    font-size: 0.8125rem;
    color: var(--bc-medium-gray);
  }

  /* Content Grid */
  .content-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .left-column,
  .right-column {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Card Styles */
  .assignments-card,
  .grades-card,
  .streak-card,
  .goal-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid #f0f0f0;
  }

  .view-link {
    font-size: 0.875rem;
    color: var(--bc-primary-blue);
    text-decoration: none;
    font-weight: 500;
    transition: opacity 0.2s ease;
  }

  .view-link:hover {
    opacity: 0.8;
  }

  /* Assignments */
  .assignments-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .assignment-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .assignment-info {
    flex: 1;
  }

  .assignment-title {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--bc-dark-gray);
    margin-bottom: 0.25rem;
  }

  .assignment-due {
    font-size: 0.75rem;
    color: var(--bc-medium-gray);
  }

  .priority-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
  }

  .priority-badge.high {
    background: #fee2e2;
    color: #dc2626;
  }

  .priority-badge.medium {
    background: #fef3c7;
    color: #d97706;
  }

  .priority-badge.low {
    background: #e0e7ff;
    color: #4f46e5;
  }

  /* Learning Streak */
  .streak-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .streak-main {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .streak-numbers {
    display: flex;
    flex-direction: column;
  }

  .current-streak {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--bc-primary-blue);
  }

  .streak-label {
    font-size: 0.875rem;
    color: var(--bc-medium-gray);
  }

  .streak-stats {
    display: flex;
    gap: 2rem;
    padding-top: 0.75rem;
    border-top: 1px solid #f0f0f0;
  }

  .streak-stat {
    display: flex;
    flex-direction: column;
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--bc-medium-gray);
    margin-bottom: 0.25rem;
  }

  .stat-value {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--bc-dark-gray);
  }

  /* Grades */
  .grades-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1rem;
  }

  .grade-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .grade-info {
    flex: 1;
  }

  .grade-assignment {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--bc-dark-gray);
    margin-bottom: 0.25rem;
  }

  .grade-date {
    font-size: 0.75rem;
    color: var(--bc-medium-gray);
  }

  .grade-score {
    display: flex;
    align-items: center;
  }

  .score {
    font-size: 1.125rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
  }

  .score.high {
    background: #dcfce7;
    color: #16a34a;
  }

  .score.medium {
    background: #fef3c7;
    color: #d97706;
  }

  .score.low {
    background: #fee2e2;
    color: #dc2626;
  }

  .average-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    margin-top: 1rem;
    border-top: 1px solid #f0f0f0;
  }

  .average-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--bc-medium-gray);
  }

  .average-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--bc-primary-blue);
  }

  /* Weekly Goal */
  .goal-content {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .goal-progress {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(to right, #b794d4, #ff9ec7);
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .goal-text {
    font-size: 0.875rem;
    color: var(--bc-medium-gray);
  }

  .goal-days {
    display: flex;
    gap: 0.5rem;
    justify-content: space-between;
  }

  .day {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: #f0f0f0;
    color: var(--bc-medium-gray);
    font-size: 0.75rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .day.completed {
    background: linear-gradient(135deg, #b794d4, #ff9ec7);
    color: white;
  }

  .day.current {
    box-shadow: 0 0 0 2px #ff9ec7;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .content-grid {
      grid-template-columns: 1fr;
    }

    .metrics-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .class-details {
      flex-direction: column;
      gap: 0.5rem;
    }

    .goal-days {
      justify-content: center;
    }

    .streak-stats {
      gap: 1rem;
    }
  }
</style>
let l=1;const D=3;let o={},f=null,y=null;function L(){const n=document.getElementById("registrationModal"),e=n?.querySelector(".modal-overlay"),t=n?.querySelector(".modal-close"),s=n?.querySelector(".btn-back"),d=n?.querySelector(".btn-next"),i=document.getElementById("courseInterest"),c=document.getElementById("childrenFields");i?.addEventListener("change",function(){this.value==="children"?c.style.display="block":c.style.display="none"}),i&&c&&(c.style.display=i.value==="children"?"block":"none"),s?.addEventListener("click",()=>x("back")),d?.addEventListener("click",()=>x("next")),e?.addEventListener("click",b),t?.addEventListener("click",b),$(),J(),F(),p()}function B(n,e){const t=document.getElementById("registrationModal");if(t){t.classList.add("active"),document.body.style.overflow="hidden",T();const s=document.getElementById("courseInterest"),d=document.getElementById("location");if(M(),s){typeof n=="string"&&n.trim().length>0?(s.value=n,o.courseInterest=n):s.value||(s.value="adults",o.courseInterest="adults");const c=document.getElementById("childrenFields");c&&(c.style.display=s.value==="children"?"block":"none")}d&&typeof e=="string"&&e.trim().length>0&&(d.value=e,o.location=e),p()}}function b(){const n=document.getElementById("registrationModal");n&&(n.classList.remove("active"),document.body.style.overflow="")}window.closeRegistrationModal=b;function x(n){if(n==="next"){if(!k())return;if(l===D){R();return}v(),l++}else n==="back"&&l>1&&l--;p()}function T(){l=1,o={},f=null,y=null,window.selectedDateElement=null,window.selectedTimeSlot=null;const n=document.querySelector(".form-success");n&&(n.style.display="none");const e=document.querySelector(".form-navigation");e&&(e.style.display="");const t=document.getElementById("timeSlots");t&&(t.style.display="none",t.style.opacity="1",t.querySelector(".slots-grid")?.replaceChildren()),document.querySelectorAll(".calendar-day.selected").forEach(s=>{s.classList.remove("selected"),s.setAttribute("data-selected","false")}),document.querySelectorAll(".time-slot.selected").forEach(s=>{s.classList.remove("selected"),s.setAttribute("data-selected","false"),s.setAttribute("aria-pressed","false")}),document.querySelector(".flexible-btn")?.classList.remove("selected"),document.querySelectorAll(".error-message").forEach(s=>{s.textContent=""}),document.querySelectorAll(".error").forEach(s=>{s.classList.remove("error")}),p()}function p(){document.querySelectorAll(".progress-step-compact").forEach((t,s)=>{const d=s+1,i=d===l,c=d<l;t.classList.toggle("active",d<=l),t.classList.toggle("current",i),t.classList.toggle("complete",c)}),document.querySelectorAll(".form-step").forEach(t=>{const s=parseInt(t.getAttribute("data-step"));t.classList.toggle("active",s===l)});const n=document.querySelector(".btn-back"),e=document.querySelector(".btn-next");if(n&&(n.style.display=l===1?"none":"inline-flex"),e){const t=e.querySelector(".btn-label"),s=l===D?"Complete Registration":"Continue";t?t.textContent=s:e.textContent=s}l===3&&P()}function k(){const e=document.querySelector(`.form-step[data-step="${l}"]`)?.querySelectorAll("[required]");let t=!0;if(e?.forEach(s=>{s.value.trim()?s.type==="email"&&!q(s.value)?(g(s,"Please enter a valid email address"),t=!1):E(s):(g(s,"This field is required"),t=!1)}),l===2){const s=document.querySelector(".flexible-btn");!f&&!y&&!s?.classList.contains("selected")&&(alert("Please select a consultation time or choose the flexible option"),t=!1)}if(l===3){const s=document.getElementById("terms");s?.checked||(g(s,"You must accept the terms and conditions"),t=!1)}return t}function q(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}function C(n){return n.parentElement?.querySelector(".error-message")||n.closest(".form-group")?.querySelector(".error-message")||n.closest(".terms-section")?.querySelector(".error-message")}function g(n,e){const t=C(n);t&&(t.textContent=e,n.classList.add("error"))}function E(n){const e=C(n);e&&(e.textContent="",n.classList.remove("error"))}function v(){document.querySelectorAll(`.form-step[data-step="${l}"] input, .form-step[data-step="${l}"] select, .form-step[data-step="${l}"] textarea`).forEach(e=>{e.type==="checkbox"?o[e.name]=e.checked:e.type==="radio"?e.checked&&(o[e.name]=e.value):o[e.name]=e.value}),l===2&&(o.selectedDate=f,o.selectedTime=y),localStorage.setItem("registrationFormData",JSON.stringify(o))}function M(){const n=localStorage.getItem("registrationFormData");n&&(o=JSON.parse(n),Object.keys(o).forEach(e=>{const t=document.querySelector(`[name="${e}"]`);t&&(t.type==="checkbox"?t.checked=o[e]:t.value=o[e])}))}function F(){document.querySelectorAll(".modal-form-full input, .modal-form-full select, .modal-form-full textarea").forEach(e=>{e.addEventListener("change",()=>{v()})})}function $(){const n=document.getElementById("calendarDays"),e=new Date,t={month:e.getMonth(),year:e.getFullYear()};n&&S(t.month,t.year),document.querySelector(".calendar-nav.prev")?.addEventListener("click",()=>{t.month--,t.month<0&&(t.month=11,t.year--),S(t.month,t.year)}),document.querySelector(".calendar-nav.next")?.addEventListener("click",()=>{t.month++,t.month>11&&(t.month=0,t.year++),S(t.month,t.year)}),document.querySelector(".flexible-btn")?.addEventListener("click",function(){this.classList.toggle("selected"),f="flexible",y="flexible"})}function S(n,e){const t=document.getElementById("calendarDays");if(!t)return;const s=new Date(e,n,1).getDay(),d=new Date(e,n+1,0).getDate(),i=new Date;i.setHours(0,0,0,0),t.innerHTML="";for(let m=0;m<(s||7)-1;m++){const a=document.createElement("div");a.className="calendar-day disabled",t.appendChild(a)}for(let m=1;m<=d;m++){const a=new Date(e,n,m);a.setHours(0,0,0,0);const h=a.getTime()===i.getTime(),I=a<i,A=a.getDay()===0||a.getDay()===6,r=document.createElement("button");r.type="button",r.className="calendar-day",r.textContent=m,r.setAttribute("data-date",a.toISOString().split("T")[0]),r.setAttribute("data-selected","false"),r.setAttribute("aria-pressed","false"),r.setAttribute("aria-label",`Select ${a.toLocaleDateString()}`),h&&r.classList.add("today"),I||A?(r.classList.add("disabled"),r.disabled=!0):(r.classList.add("available"),r.addEventListener("click",w=>N(a,w)),window.selectedDateElement&&window.selectedDateElement.date===m&&window.selectedDateElement.month===n&&window.selectedDateElement.year===e&&r.classList.add("selected")),t.appendChild(r)}const c=["January","February","March","April","May","June","July","August","September","October","November","December"],u=document.querySelector(".calendar-month");u&&(u.textContent=`${c[n]} ${e}`)}function N(n,e){f=n,document.querySelectorAll(".calendar-day").forEach(t=>{t.classList.remove("selected"),t.setAttribute("data-selected","false"),t.setAttribute("aria-pressed","false")}),e&&e.currentTarget&&(e.currentTarget.classList.add("selected"),e.currentTarget.setAttribute("data-selected","true"),e.currentTarget.setAttribute("aria-pressed","true"),e.currentTarget.offsetHeight,window.selectedDateElement={date:n.getDate(),month:n.getMonth(),year:n.getFullYear()}),H()}function H(n){const e=document.getElementById("timeSlots"),t=e?.querySelector(".slots-grid");if(e&&t){e.style.display="block";const s=["09:00","09:30","10:00","10:30","11:00","11:30"],d=["14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"],i=[...s,...d],c=i.filter(()=>Math.random()>.15);if(c.length<4&&c.push(...i.slice(0,6)),t.innerHTML="",e.style.opacity="0",setTimeout(()=>{e.style.transition="opacity 0.3s ease",e.style.opacity="1"},10),c.forEach((u,m)=>{const a=document.createElement("button");a.type="button",a.className="time-slot",a.textContent=u,a.setAttribute("data-time",u),a.setAttribute("data-selected","false"),a.setAttribute("aria-pressed","false"),a.setAttribute("aria-label",`Select ${u} consultation time`),a.style.animationDelay=`${m*30}ms`,a.style.animation="fadeInUp 0.4s ease forwards",a.addEventListener("click",h=>O(u,h)),window.selectedTimeSlot===u&&a.classList.add("selected"),t.appendChild(a)}),!document.getElementById("timeSlotAnimation")){const u=document.createElement("style");u.id="timeSlotAnimation",u.textContent=`
          @keyframes fadeInUp {
            from {
              opacity: 0;
              transform: translateY(10px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
        `,document.head.appendChild(u)}}}function O(n,e){y=n,document.querySelectorAll(".time-slot").forEach(t=>{t.classList.remove("selected"),t.setAttribute("data-selected","false"),t.setAttribute("aria-pressed","false")}),e&&e.currentTarget&&(e.currentTarget.classList.add("selected"),e.currentTarget.setAttribute("data-selected","true"),e.currentTarget.setAttribute("aria-pressed","true"),e.currentTarget.offsetHeight,window.selectedTimeSlot=n,e.currentTarget.style.animation="confirmSelection 0.3s ease",setTimeout(()=>{e.currentTarget&&(e.currentTarget.style.animation="")},300))}function P(){document.getElementById("summaryName").textContent=o.fullName||"-",document.getElementById("summaryEmail").textContent=o.email||"-",document.getElementById("summaryPhone").textContent=`${o.phoneCode||""} ${o.phone||"-"}`,document.getElementById("summaryCourse").textContent=o.courseInterest||"-",document.getElementById("summaryLocation").textContent=o.location||"-",f==="flexible"?(document.getElementById("summaryDate").textContent="Flexible scheduling requested",document.getElementById("summaryTime").textContent="We will contact you with options"):f&&y&&(document.getElementById("summaryDate").textContent=f.toLocaleDateString(),document.getElementById("summaryTime").textContent=y)}function R(){v(),document.querySelectorAll(".form-step").forEach(e=>{e.classList.remove("active")});const n=document.querySelector(".form-navigation");n&&(n.style.display="none"),document.querySelector(".form-success").style.display="block",localStorage.removeItem("registrationFormData"),o={}}function J(){document.getElementById("email")?.addEventListener("blur",function(){this.value&&!q(this.value)?g(this,"Please enter a valid email address"):E(this)}),document.getElementById("phone")?.addEventListener("blur",function(){this.value&&!/^\d{9,}$/.test(this.value.replace(/\s/g,""))?g(this,"Please enter a valid phone number"):E(this)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L();window.openRegistrationModal=B;
